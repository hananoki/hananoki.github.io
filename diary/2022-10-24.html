<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
</head>
<title>hananoki.github.io</title>
<link href="../img/favicon.webp" rel="icon" type="image/png">
<link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c|Nanum+Gothic|Roboto" rel="stylesheet" />
<link href="../css/side.css" rel="stylesheet">
<link href="../css/markdown7_side.css" rel="stylesheet">

<body>

<article>
<div class="side">
<p><a href="2022-09-29.html">自分でSpawnActorしたカメラがアクティブな表示にならない</a></p>
<p><a href="2022-09-30.html">Delayノードのキャンセル (悩)</a></p>
<p><a href="2022-10-24.html">いいかもしれない、WebP</a></p>
</div> 
<div class="content">
<h4 id="section">2022-10-24</h4>
<h1 id="いいかもしれないwebp">いいかもしれない、WebP</h1>
<p>たまには文章を書いてみようと思い立ったので書いてみた。</p>
<ul>
<li><a href="#とある日">とある日</a></li>
<li><a href="#WebPに変換">WebPに変換</a></li>
<li><a href="#WebPの圧縮オプションを試す">WebPの圧縮オプションを試す</a></li>
<li><a href="#他のWebPの圧縮オプションを試す">他のWebPの圧縮オプションを試す</a></li>
<li><a href="#別の画像で試す">別の画像で試す</a></li>
<li><a href="#さいごに">さいごに</a></li>
</ul>
<h2 id="とある日">とある日</h2>
<p>画像をチョイっとダウンロードした時、よくみるとWebPじゃねーか、という事案が近年よく遭遇してめんどいなぁと思っていました。<br />
で最近ページ作ったりして自分で見てて思ったのが「シンプルな割に遅い気がする」と思ってました。<br />
それで最適化まわりの情報を探してて、画像の最適化、というのがあって当時はスルーしてたんですけど、もしやと調べてみた、そんな話です。</p>
<h2 id="webpに変換">WebPに変換</h2>
<p>公式がコマンドラインツールを配布してました。</p>
<p><a href="https://developers.google.com/speed/webp/download">WebP
のダウンロードとインストール</a></p>
<p>画像ファイルを圧縮するのは<code>cwebp</code>なのでザックリこんな感じでOK。</p>
<pre><code>cwebp sample.png -o sample.webp</code></pre>
<p>結果は</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_sample.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>25,994 バイト</td>
</tr>
</tbody>
</table>
<ul>
<li>ファイルサイズはウットリするほど縮まった</li>
<li>pngに比べて明らかに劣化してる</li>
</ul>
<p>実際見比べないと分からないので、これでもいいかという気もしますが、個人的にはちょっと許容し難いなと思いました。</p>
<h2 id="webpの圧縮オプションを試す">WebPの圧縮オプションを試す</h2>
<p>WebPは可逆圧縮と非可逆圧縮のどちらでもいけるっぽいですが、デフォルトはどうも可逆圧縮、オプションを弄ることでマシにならないかと思いました。<br />
とはいえ秘伝のタレみたいな組み合わせを探すのも嫌なので、一つ二つ程度でやれそうなものにしたいです。</p>
<p><a
href="https://developers.google.com/speed/webp/docs/cwebp">cwebp</a>のオプションを適当に見てみると使えそうかなと思ったのが</p>
<ul>
<li>-preset string
プリセット(default、photo、picture、drawing、icon、text)</li>
<li>-m int 圧縮方法を指定 (0～6、デフォルト値は 4)</li>
</ul>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>png</th>
<th>-preset default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_default.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>25,994 バイト</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>png</th>
<th>-preset photo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_photo.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>25,290 バイト</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>png</th>
<th>-preset picture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_picture.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>25,224 バイト</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>png</th>
<th>-preset drawing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_drawing.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>27,216 バイト</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-preset icon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_icon.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>28,234 バイト</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-preset text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_text.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>28,234 バイト</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-m 6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_m6.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>25,612 バイト</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-m 0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_m0.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>38,976 バイト</td>
</tr>
</tbody>
</table>
<h3 id="所感">所感</h3>
<p>いろいろ試した結果としては、結局デフォルトの状態から閾値をちょっと弄っただけのような感じで、pngっぽさに近づけようとするには、使い物にならないオプションでした。</p>
<h2
id="他のwebpの圧縮オプションを試す">他のWebPの圧縮オプションを試す</h2>
<p>正直疲れたので諦めようと思ってたのですがもう一つオプションを試してみました。</p>
<ul>
<li>-q float RGB チャネルの圧縮率を 0～100
の範囲で指定します。デフォルトは 75 です。</li>
</ul>
<p>選んだ理由は<code>-q</code>をクオリティだと思ったからで、今説明を改めてみると、何だろコレって感じですね。</p>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-q 100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_q100.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>89,702 バイト</td>
</tr>
</tbody>
</table>
<p><strong>お、割といい感じなのでは。</strong></p>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-q 90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_q90.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>43,536 バイト</td>
</tr>
</tbody>
</table>
<p><strong>お、サイズが、ちょっと劣化が気になる</strong></p>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-q 80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sample.png" /></td>
<td><img src="2022-10-24/20221024_q80.webp" /></td>
</tr>
<tr class="even">
<td>327,536 バイト</td>
<td>30,394 バイト</td>
</tr>
</tbody>
</table>
<p><strong>うーん</strong></p>
<p>このオプションはアリだなと思ったのですが<code>100</code>にするか<code>90</code>にするか。</p>
<h2 id="別の画像で試す">別の画像で試す</h2>
<p>今回はサイズを優先したいと思いましたが、別の画像でもどうかなと思いました。</p>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-q 90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_bc.png" /></td>
<td><img src="2022-10-24/20221024_bc.webp" /></td>
</tr>
<tr class="even">
<td>247,616 バイト</td>
<td>47,092 バイト</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-q 90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_sf.png" /></td>
<td><img src="2022-10-24/20221024_sf.webp" /></td>
</tr>
<tr class="even">
<td>261,496 バイト</td>
<td>44,670 バイト</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>png</th>
<th>-q 90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="2022-10-24/20221024_10.png" /></td>
<td><img src="2022-10-24/20221024_10.webp" /></td>
</tr>
<tr class="even">
<td>217,313 バイト</td>
<td>44,506 バイト</td>
</tr>
</tbody>
</table>
<p>正直パッと見る分には分からないです。<br />
手元の画像ビューアで大きくして見てると、ところどころ劣化してる部分はあるのですが、大きめの画像を縮小して表示する分には問題ないかなと思いました。</p>
<h2 id="さいごに">さいごに</h2>
<p><code>png</code>にこだわる理由もないので<code>jpg</code>でもいいかなとちょっと試した感じ、やっぱノイズが。<br />
圧縮レベル上げればマシになりますがサイズの旨味がちょっとなぁと。</p>
<p>そうゆう意味では</p>
<ul>
<li>ほどほどに劣化してノイズらない</li>
<li>サイズも標準圧縮よりチョイ増し</li>
</ul>
<p>ってとこで<code>-q 90</code>あたりで納得できる感じかなぁというところです。</p>
<p>後はコマンドライン毎回打つわけにもいかない（めんどい）ので、そのあたりどうすっかな、といったところです。</p>

</div>
</article>

</body>
</html>